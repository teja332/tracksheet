{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nconst uri = process.env.MONGODB_URI;\r\n\r\nif (!uri) {\r\n  throw new Error(\"Missing MONGODB_URI in environment\");\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\nlet clientPromise: Promise<MongoClient> | null = null;\r\n\r\nexport async function getMongoClient(): Promise<MongoClient> {\r\n  if (client) return client;\r\n  if (!clientPromise) {\r\n    clientPromise = new MongoClient(uri).connect();\r\n  }\r\n  client = await clientPromise;\r\n  return client;\r\n}\r\n\r\nexport async function getDb() {\r\n  const mongoClient = await getMongoClient();\r\n  return mongoClient.db();\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAE1C,eAAe;IACpB,IAAI,QAAQ,OAAO;IACnB,IAAI,CAAC,eAAe;QAClB,gBAAgB,IAAI,sHAAW,CAAC,KAAK,OAAO;IAC9C;IACA,SAAS,MAAM;IACf,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM;IAC1B,OAAO,YAAY,EAAE;AACvB","debugId":null}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nexport type AuthTokenPayload = {\r\n  role: \"student\" | \"staff\";\r\n  rollNumber?: string;\r\n  staffId?: string;\r\n  email: string;\r\n};\r\n\r\nconst jwtSecret = process.env.JWT_SECRET;\r\nconst jwtExpiresIn = process.env.JWT_EXPIRES_IN || \"7d\";\r\n\r\nif (!jwtSecret) {\r\n  throw new Error(\"Missing JWT_SECRET in environment\");\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload) {\r\n  return jwt.sign(payload, jwtSecret, { expiresIn: jwtExpiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload {\r\n  return jwt.verify(token, jwtSecret) as AuthTokenPayload;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AASA,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;AACxC,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc,IAAI;AAEnD,IAAI,CAAC,WAAW;IACd,MAAM,IAAI,MAAM;AAClB;AAEO,SAAS,cAAc,OAAyB;IACrD,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,WAAW;QAAE,WAAW;IAAa;AAChE;AAEO,SAAS,gBAAgB,KAAa;IAC3C,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;AAC3B","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth-server.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { AuthTokenPayload, verifyAuthToken } from \"./auth\";\r\n\r\nconst COOKIE_NAME = \"tracksheet_token\";\r\n\r\nexport function getAuthFromRequest(request: NextRequest): AuthTokenPayload | null {\r\n  const token = request.cookies.get(COOKIE_NAME)?.value;\r\n  if (!token) return null;\r\n  try {\r\n    return verifyAuthToken(token);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function getAuthCookieName() {\r\n  return COOKIE_NAME;\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,MAAM,cAAc;AAEb,SAAS,mBAAmB,OAAoB;IACrD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IAChD,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,IAAA,gIAAe,EAAC;IACzB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS;IACd,OAAO;AACT","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/app/api/staff/assigned/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { getDb } from \"@/lib/mongodb\";\r\nimport { getAuthFromRequest } from \"@/lib/auth-server\";\r\n\r\nconst normalizeBranch = (value: string | undefined) =>\r\n  (value || \"\").trim().toUpperCase();\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const auth = getAuthFromRequest(request);\r\n  if (!auth || auth.role !== \"staff\" || !auth.staffId) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }\r\n\r\n  const db = await getDb();\r\n  const staffBranchMap = db.collection(\"staffBranchMap\");\r\n  const branches = db.collection(\"branches\");\r\n  const profiles = db.collection(\"sProfile\");\r\n\r\n  const mapping = await staffBranchMap.findOne({ staffId: auth.staffId });\r\n  if (!mapping?.branchId) {\r\n    return NextResponse.json({ branch: null, students: [] });\r\n  }\r\n\r\n  const branch = await branches.findOne({ branchId: mapping.branchId });\r\n  const branchKey = normalizeBranch(branch?.branchName || branch?.branchId);\r\n\r\n  const studentDocs = await profiles\r\n    .find({})\r\n    .toArray();\r\n\r\n  const students = studentDocs\r\n    .filter((doc) => normalizeBranch(doc[\"Branch\"]) === branchKey)\r\n    .map((doc) => ({\r\n      rollNumber: String(doc[\"Roll no\"] || \"\"),\r\n      fullName: String(doc[\"Full name\"] || \"\"),\r\n      email: String(doc[\"Email\"] || \"\"),\r\n      year: String(doc[\"Year\"] || \"\"),\r\n      section: String(doc[\"Section\"] || \"\"),\r\n      branch: String(doc[\"Branch\"] || \"\"),\r\n    }))\r\n    .filter((student) => student.rollNumber);\r\n\r\n  return NextResponse.json({\r\n    branch: branchKey,\r\n    students,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,kBAAkB,CAAC,QACvB,CAAC,SAAS,EAAE,EAAE,IAAI,GAAG,WAAW;AAE3B,eAAe,IAAI,OAAoB;IAC5C,MAAM,OAAO,IAAA,6IAAkB,EAAC;IAChC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW,CAAC,KAAK,OAAO,EAAE;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,KAAK,MAAM,IAAA,yHAAK;IACtB,MAAM,iBAAiB,GAAG,UAAU,CAAC;IACrC,MAAM,WAAW,GAAG,UAAU,CAAC;IAC/B,MAAM,WAAW,GAAG,UAAU,CAAC;IAE/B,MAAM,UAAU,MAAM,eAAe,OAAO,CAAC;QAAE,SAAS,KAAK,OAAO;IAAC;IACrE,IAAI,CAAC,SAAS,UAAU;QACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;YAAM,UAAU,EAAE;QAAC;IACxD;IAEA,MAAM,SAAS,MAAM,SAAS,OAAO,CAAC;QAAE,UAAU,QAAQ,QAAQ;IAAC;IACnE,MAAM,YAAY,gBAAgB,QAAQ,cAAc,QAAQ;IAEhE,MAAM,cAAc,MAAM,SACvB,IAAI,CAAC,CAAC,GACN,OAAO;IAEV,MAAM,WAAW,YACd,MAAM,CAAC,CAAC,MAAQ,gBAAgB,GAAG,CAAC,SAAS,MAAM,WACnD,GAAG,CAAC,CAAC,MAAQ,CAAC;YACb,YAAY,OAAO,GAAG,CAAC,UAAU,IAAI;YACrC,UAAU,OAAO,GAAG,CAAC,YAAY,IAAI;YACrC,OAAO,OAAO,GAAG,CAAC,QAAQ,IAAI;YAC9B,MAAM,OAAO,GAAG,CAAC,OAAO,IAAI;YAC5B,SAAS,OAAO,GAAG,CAAC,UAAU,IAAI;YAClC,QAAQ,OAAO,GAAG,CAAC,SAAS,IAAI;QAClC,CAAC,GACA,MAAM,CAAC,CAAC,UAAY,QAAQ,UAAU;IAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,QAAQ;QACR;IACF;AACF","debugId":null}}]
}
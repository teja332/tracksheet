{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nconst uri = process.env.MONGODB_URI;\r\n\r\nif (!uri) {\r\n  throw new Error(\"Missing MONGODB_URI in environment\");\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\nlet clientPromise: Promise<MongoClient> | null = null;\r\n\r\nexport async function getMongoClient(): Promise<MongoClient> {\r\n  if (client) return client;\r\n  if (!clientPromise) {\r\n    clientPromise = new MongoClient(uri).connect();\r\n  }\r\n  client = await clientPromise;\r\n  return client;\r\n}\r\n\r\nexport async function getDb() {\r\n  const mongoClient = await getMongoClient();\r\n  return mongoClient.db();\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAE1C,eAAe;IACpB,IAAI,QAAQ,OAAO;IACnB,IAAI,CAAC,eAAe;QAClB,gBAAgB,IAAI,sHAAW,CAAC,KAAK,OAAO;IAC9C;IACA,SAAS,MAAM;IACf,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM;IAC1B,OAAO,YAAY,EAAE;AACvB","debugId":null}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nexport type AuthTokenPayload = {\r\n  role: \"student\" | \"staff\";\r\n  rollNumber?: string;\r\n  staffId?: string;\r\n  email: string;\r\n};\r\n\r\nconst jwtSecret = process.env.JWT_SECRET;\r\nconst jwtExpiresIn = process.env.JWT_EXPIRES_IN || \"7d\";\r\n\r\nif (!jwtSecret) {\r\n  throw new Error(\"Missing JWT_SECRET in environment\");\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload) {\r\n  return jwt.sign(payload, jwtSecret, { expiresIn: jwtExpiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload {\r\n  return jwt.verify(token, jwtSecret) as AuthTokenPayload;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AASA,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;AACxC,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc,IAAI;AAEnD,IAAI,CAAC,WAAW;IACd,MAAM,IAAI,MAAM;AAClB;AAEO,SAAS,cAAc,OAAyB;IACrD,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,WAAW;QAAE,WAAW;IAAa;AAChE;AAEO,SAAS,gBAAgB,KAAa;IAC3C,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;AAC3B","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth-server.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { AuthTokenPayload, verifyAuthToken } from \"./auth\";\r\n\r\nconst COOKIE_NAME = \"tracksheet_token\";\r\n\r\nexport function getAuthFromRequest(request: NextRequest): AuthTokenPayload | null {\r\n  const token = request.cookies.get(COOKIE_NAME)?.value;\r\n  if (!token) return null;\r\n  try {\r\n    return verifyAuthToken(token);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function getAuthCookieName() {\r\n  return COOKIE_NAME;\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,MAAM,cAAc;AAEb,SAAS,mBAAmB,OAAoB;IACrD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IAChD,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,IAAA,gIAAe,EAAC;IACzB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS;IACd,OAAO;AACT","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/app/api/student/upload-excel/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { getDb } from \"@/lib/mongodb\"\r\nimport { getAuthFromRequest } from \"@/lib/auth-server\"\r\n// @ts-ignore\r\nimport bcrypt from \"bcryptjs\"\r\nimport * as XLSX from \"xlsx\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const auth = getAuthFromRequest(request)\r\n    if (!auth || auth.role !== \"staff\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const formData = await request.formData()\r\n    const file = formData.get(\"file\") as File\r\n\r\n    if (!file) {\r\n      return NextResponse.json({ error: \"No file provided\" }, { status: 400 })\r\n    }\r\n\r\n    // Validate file type - only Excel files\r\n    const validExtensions = [\".xlsx\", \".xls\", \".csv\"]\r\n    const fileName = file.name.toLowerCase()\r\n    const isValidFile = validExtensions.some((ext) => fileName.endsWith(ext))\r\n\r\n    if (!isValidFile) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid file type. Only .xlsx, .xls, and .csv files are allowed\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Read file buffer\r\n    const buffer = await file.arrayBuffer()\r\n    const uint8Array = new Uint8Array(buffer)\r\n\r\n    // Parse Excel file\r\n    const workbook = XLSX.read(uint8Array, { type: \"array\" })\r\n    const sheetName = workbook.SheetNames[0]\r\n    const worksheet = workbook.Sheets[sheetName]\r\n    const data = XLSX.utils.sheet_to_json(worksheet)\r\n\r\n    if (!data || data.length === 0) {\r\n      return NextResponse.json({ error: \"Excel file is empty\" }, { status: 400 })\r\n    }\r\n\r\n    const db = await getDb()\r\n    const profileCollection = db.collection(\"sProfile\")\r\n    const academicCollection = db.collection(\"sAcademics\")\r\n    const cocircularCollection = db.collection(\"sCociruculars\")\r\n    const extracircularCollection = db.collection(\"sEcirculars\")\r\n    const usersCollection = db.collection(\"users\")\r\n\r\n    let successCount = 0\r\n    let errorCount = 0\r\n    const errors: string[] = []\r\n\r\n    // Process each row\r\n    for (const row of data) {\r\n      try {\r\n        // Extract and validate required fields from Excel (case-insensitive)\r\n        const rowData = row as Record<string, any>\r\n        const fullName =\r\n          rowData[\"Full name\"] ||\r\n          rowData[\"full name\"] ||\r\n          rowData[\"Full Name\"] ||\r\n          rowData[\"name\"] ||\r\n          rowData[\"Name\"] ||\r\n          \"\"\r\n        const rollNumber =\r\n          rowData[\"Roll no\"] || rowData[\"roll no\"] || rowData[\"Roll No\"] || rowData[\"rollNumber\"] || \"\"\r\n        const email = rowData[\"Email\"] || rowData[\"email\"] || rowData[\"EMAIL\"] || \"\"\r\n\r\n        if (!fullName || !rollNumber || !email) {\r\n          errors.push(\r\n            `Row skipped: Missing required fields (Full name, Roll no, Email)`\r\n          )\r\n          errorCount++\r\n          continue\r\n        }\r\n\r\n        // Check if student already exists\r\n        const existingStudent = await profileCollection.findOne({\r\n          \"Roll no\": String(rollNumber),\r\n        })\r\n        if (existingStudent) {\r\n          errors.push(`Row skipped: Student with roll number ${rollNumber} already exists`)\r\n          errorCount++\r\n          continue\r\n        }\r\n\r\n        // Extract optional fields\r\n        const phone = rowData[\"Phone\"] || rowData[\"phone\"] || \"\"\r\n        const dob = rowData[\"Date of Birth\"] || rowData[\"DoB\"] || rowData[\"dob\"] || \"\"\r\n        const address = rowData[\"Address\"] || rowData[\"address\"] || \"\"\r\n        const year = rowData[\"Year\"] || rowData[\"year\"] || \"\"\r\n        const branch = rowData[\"Branch\"] || rowData[\"branch\"] || \"\"\r\n        const section = rowData[\"Section\"] || rowData[\"section\"] || \"\"\r\n        const parentName = rowData[\"Parent Name\"] || rowData[\"parent name\"] || \"\"\r\n        const parentPhone = rowData[\"Parent Phone\"] || rowData[\"parent phone\"] || \"\"\r\n        const leetcode = rowData[\"LeetCode\"] || rowData[\"leetcode\"] || \"username_here\"\r\n        const codeforces = rowData[\"CodeForces\"] || rowData[\"codeforces\"] || \"username_here\"\r\n        const hackerrank = rowData[\"HackerRank\"] || rowData[\"hackerrank\"] || \"username_here\"\r\n        const codechef = rowData[\"CodeChef\"] || rowData[\"codechef\"] || \"username_here\"\r\n\r\n        // Create profile entry with all fields from Excel\r\n        const profileData = {\r\n          \"Full name\": String(fullName),\r\n          \"Roll no\": String(rollNumber),\r\n          Email: String(email),\r\n          Phone: String(phone),\r\n          \"Date of Birth\": String(dob),\r\n          Address: String(address),\r\n          Year: String(year),\r\n          Branch: String(branch),\r\n          Section: String(section),\r\n          \"Parent Name\": String(parentName),\r\n          \"Parent Phone\": String(parentPhone),\r\n          LeetCode: String(leetcode),\r\n          CodeForces: String(codeforces),\r\n          HackerRank: String(hackerrank),\r\n          CodeChef: String(codechef),\r\n        }\r\n\r\n        // Create academic entry\r\n        const academicData = {\r\n          \"Full name\": String(fullName),\r\n          \"Roll no\": String(rollNumber),\r\n          Mathematics: 0,\r\n          Physics: 0,\r\n          Chemistry: 0,\r\n        }\r\n\r\n        // Create co-curricular entry\r\n        const cocircularData = {\r\n          \"Full name\": String(fullName),\r\n          \"Roll no\": String(rollNumber),\r\n          Sports: \"none\",\r\n          Cultural: \"none\",\r\n          Technical: \"none\",\r\n        }\r\n\r\n        // Create extra-curricular entry\r\n        const extracircularData = {\r\n          \"Full name\": String(fullName),\r\n          \"Roll no\": String(rollNumber),\r\n          Clubs: \"none\",\r\n          Competitions: \"none\",\r\n          Events: \"none\",\r\n        }\r\n\r\n        // Hash password and create user entry\r\n        const hashedPassword = await bcrypt.hash(String(email), 10)\r\n        const userData = {\r\n          email: String(email),\r\n          password: hashedPassword,\r\n          role: \"student\",\r\n          rollNumber: String(rollNumber),\r\n          fullName: String(fullName),\r\n          createdAt: new Date(),\r\n        }\r\n\r\n        // Insert all data simultaneously\r\n        await Promise.all([\r\n          profileCollection.insertOne(profileData),\r\n          academicCollection.insertOne(academicData),\r\n          cocircularCollection.insertOne(cocircularData),\r\n          extracircularCollection.insertOne(extracircularData),\r\n          usersCollection.insertOne(userData),\r\n        ])\r\n\r\n        successCount++\r\n      } catch (rowError) {\r\n        errors.push(\r\n          `Row error: ${rowError instanceof Error ? rowError.message : \"Unknown error\"}`\r\n        )\r\n        errorCount++\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: `Successfully imported ${successCount} students`,\r\n      successCount,\r\n      errorCount,\r\n      errors: errors.length > 0 ? errors : undefined,\r\n      total: data.length,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Error uploading Excel:\", error)\r\n    return NextResponse.json(\r\n      { error: error instanceof Error ? error.message : \"Internal server error\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA,aAAa;AACb;AACA;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,IAAA,6IAAkB,EAAC;QAChC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,wCAAwC;QACxC,MAAM,kBAAkB;YAAC;YAAS;YAAQ;SAAO;QACjD,MAAM,WAAW,KAAK,IAAI,CAAC,WAAW;QACtC,MAAM,cAAc,gBAAgB,IAAI,CAAC,CAAC,MAAQ,SAAS,QAAQ,CAAC;QAEpE,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkE,GAC3E;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,SAAS,MAAM,KAAK,WAAW;QACrC,MAAM,aAAa,IAAI,WAAW;QAElC,mBAAmB;QACnB,MAAM,WAAW,uIAAS,CAAC,YAAY;YAAE,MAAM;QAAQ;QACvD,MAAM,YAAY,SAAS,UAAU,CAAC,EAAE;QACxC,MAAM,YAAY,SAAS,MAAM,CAAC,UAAU;QAC5C,MAAM,OAAO,wIAAU,CAAC,aAAa,CAAC;QAEtC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,KAAK,MAAM,IAAA,yHAAK;QACtB,MAAM,oBAAoB,GAAG,UAAU,CAAC;QACxC,MAAM,qBAAqB,GAAG,UAAU,CAAC;QACzC,MAAM,uBAAuB,GAAG,UAAU,CAAC;QAC3C,MAAM,0BAA0B,GAAG,UAAU,CAAC;QAC9C,MAAM,kBAAkB,GAAG,UAAU,CAAC;QAEtC,IAAI,eAAe;QACnB,IAAI,aAAa;QACjB,MAAM,SAAmB,EAAE;QAE3B,mBAAmB;QACnB,KAAK,MAAM,OAAO,KAAM;YACtB,IAAI;gBACF,qEAAqE;gBACrE,MAAM,UAAU;gBAChB,MAAM,WACJ,OAAO,CAAC,YAAY,IACpB,OAAO,CAAC,YAAY,IACpB,OAAO,CAAC,YAAY,IACpB,OAAO,CAAC,OAAO,IACf,OAAO,CAAC,OAAO,IACf;gBACF,MAAM,aACJ,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,aAAa,IAAI;gBAC7F,MAAM,QAAQ,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,IAAI;gBAE1E,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,OAAO;oBACtC,OAAO,IAAI,CACT,CAAC,gEAAgE,CAAC;oBAEpE;oBACA;gBACF;gBAEA,kCAAkC;gBAClC,MAAM,kBAAkB,MAAM,kBAAkB,OAAO,CAAC;oBACtD,WAAW,OAAO;gBACpB;gBACA,IAAI,iBAAiB;oBACnB,OAAO,IAAI,CAAC,CAAC,sCAAsC,EAAE,WAAW,eAAe,CAAC;oBAChF;oBACA;gBACF;gBAEA,0BAA0B;gBAC1B,MAAM,QAAQ,OAAO,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,IAAI;gBACtD,MAAM,MAAM,OAAO,CAAC,gBAAgB,IAAI,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,IAAI;gBAC5E,MAAM,UAAU,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,IAAI;gBAC5D,MAAM,OAAO,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI;gBACnD,MAAM,SAAS,OAAO,CAAC,SAAS,IAAI,OAAO,CAAC,SAAS,IAAI;gBACzD,MAAM,UAAU,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,IAAI;gBAC5D,MAAM,aAAa,OAAO,CAAC,cAAc,IAAI,OAAO,CAAC,cAAc,IAAI;gBACvE,MAAM,cAAc,OAAO,CAAC,eAAe,IAAI,OAAO,CAAC,eAAe,IAAI;gBAC1E,MAAM,WAAW,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,WAAW,IAAI;gBAC/D,MAAM,aAAa,OAAO,CAAC,aAAa,IAAI,OAAO,CAAC,aAAa,IAAI;gBACrE,MAAM,aAAa,OAAO,CAAC,aAAa,IAAI,OAAO,CAAC,aAAa,IAAI;gBACrE,MAAM,WAAW,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,WAAW,IAAI;gBAE/D,kDAAkD;gBAClD,MAAM,cAAc;oBAClB,aAAa,OAAO;oBACpB,WAAW,OAAO;oBAClB,OAAO,OAAO;oBACd,OAAO,OAAO;oBACd,iBAAiB,OAAO;oBACxB,SAAS,OAAO;oBAChB,MAAM,OAAO;oBACb,QAAQ,OAAO;oBACf,SAAS,OAAO;oBAChB,eAAe,OAAO;oBACtB,gBAAgB,OAAO;oBACvB,UAAU,OAAO;oBACjB,YAAY,OAAO;oBACnB,YAAY,OAAO;oBACnB,UAAU,OAAO;gBACnB;gBAEA,wBAAwB;gBACxB,MAAM,eAAe;oBACnB,aAAa,OAAO;oBACpB,WAAW,OAAO;oBAClB,aAAa;oBACb,SAAS;oBACT,WAAW;gBACb;gBAEA,6BAA6B;gBAC7B,MAAM,iBAAiB;oBACrB,aAAa,OAAO;oBACpB,WAAW,OAAO;oBAClB,QAAQ;oBACR,UAAU;oBACV,WAAW;gBACb;gBAEA,gCAAgC;gBAChC,MAAM,oBAAoB;oBACxB,aAAa,OAAO;oBACpB,WAAW,OAAO;oBAClB,OAAO;oBACP,cAAc;oBACd,QAAQ;gBACV;gBAEA,sCAAsC;gBACtC,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,OAAO,QAAQ;gBACxD,MAAM,WAAW;oBACf,OAAO,OAAO;oBACd,UAAU;oBACV,MAAM;oBACN,YAAY,OAAO;oBACnB,UAAU,OAAO;oBACjB,WAAW,IAAI;gBACjB;gBAEA,iCAAiC;gBACjC,MAAM,QAAQ,GAAG,CAAC;oBAChB,kBAAkB,SAAS,CAAC;oBAC5B,mBAAmB,SAAS,CAAC;oBAC7B,qBAAqB,SAAS,CAAC;oBAC/B,wBAAwB,SAAS,CAAC;oBAClC,gBAAgB,SAAS,CAAC;iBAC3B;gBAED;YACF,EAAE,OAAO,UAAU;gBACjB,OAAO,IAAI,CACT,CAAC,WAAW,EAAE,oBAAoB,QAAQ,SAAS,OAAO,GAAG,iBAAiB;gBAEhF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS,CAAC,sBAAsB,EAAE,aAAa,SAAS,CAAC;YACzD;YACA;YACA,QAAQ,OAAO,MAAM,GAAG,IAAI,SAAS;YACrC,OAAO,KAAK,MAAM;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAwB,GAC1E;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}
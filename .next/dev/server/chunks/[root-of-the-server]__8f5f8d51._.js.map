{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nconst uri = process.env.MONGODB_URI;\r\n\r\nif (!uri) {\r\n  throw new Error(\"Missing MONGODB_URI in environment\");\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\nlet clientPromise: Promise<MongoClient> | null = null;\r\n\r\nexport async function getMongoClient(): Promise<MongoClient> {\r\n  if (client) return client;\r\n  if (!clientPromise) {\r\n    clientPromise = new MongoClient(uri).connect();\r\n  }\r\n  client = await clientPromise;\r\n  return client;\r\n}\r\n\r\nexport async function getDb() {\r\n  const mongoClient = await getMongoClient();\r\n  return mongoClient.db();\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AAEnC,IAAI,CAAC,KAAK;IACR,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAE1C,eAAe;IACpB,IAAI,QAAQ,OAAO;IACnB,IAAI,CAAC,eAAe;QAClB,gBAAgB,IAAI,sHAAW,CAAC,KAAK,OAAO;IAC9C;IACA,SAAS,MAAM;IACf,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM;IAC1B,OAAO,YAAY,EAAE;AACvB","debugId":null}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\nexport type AuthTokenPayload = {\r\n  role: \"student\" | \"staff\";\r\n  rollNumber?: string;\r\n  staffId?: string;\r\n  email: string;\r\n};\r\n\r\nconst jwtSecret = process.env.JWT_SECRET;\r\nconst jwtExpiresIn = process.env.JWT_EXPIRES_IN || \"7d\";\r\n\r\nif (!jwtSecret) {\r\n  throw new Error(\"Missing JWT_SECRET in environment\");\r\n}\r\n\r\nexport function signAuthToken(payload: AuthTokenPayload) {\r\n  return jwt.sign(payload, jwtSecret, { expiresIn: jwtExpiresIn });\r\n}\r\n\r\nexport function verifyAuthToken(token: string): AuthTokenPayload {\r\n  return jwt.verify(token, jwtSecret) as AuthTokenPayload;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AASA,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;AACxC,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc,IAAI;AAEnD,IAAI,CAAC,WAAW;IACd,MAAM,IAAI,MAAM;AAClB;AAEO,SAAS,cAAc,OAAyB;IACrD,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,WAAW;QAAE,WAAW;IAAa;AAChE;AAEO,SAAS,gBAAgB,KAAa;IAC3C,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;AAC3B","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/lib/auth-server.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport { AuthTokenPayload, verifyAuthToken } from \"./auth\";\r\n\r\nconst COOKIE_NAME = \"tracksheet_token\";\r\n\r\nexport function getAuthFromRequest(request: NextRequest): AuthTokenPayload | null {\r\n  const token = request.cookies.get(COOKIE_NAME)?.value;\r\n  if (!token) return null;\r\n  try {\r\n    return verifyAuthToken(token);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function getAuthCookieName() {\r\n  return COOKIE_NAME;\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;;AAEA,MAAM,cAAc;AAEb,SAAS,mBAAmB,OAAoB;IACrD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IAChD,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,IAAA,gIAAe,EAAC;IACzB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS;IACd,OAAO;AACT","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Tejab/Desktop/final_year_project/TRACKSHEET/UI/app/api/student/add/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { getDb } from \"@/lib/mongodb\"\r\nimport { getAuthFromRequest } from \"@/lib/auth-server\"\r\n// @ts-ignore\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const auth = getAuthFromRequest(request)\r\n    if (!auth || auth.role !== \"staff\") {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const body = await request.json()\r\n    const {\r\n      fullName,\r\n      rollNumber,\r\n      email,\r\n      phone,\r\n      dob,\r\n      address,\r\n      year,\r\n      branch,\r\n      section,\r\n      parentName,\r\n      parentPhone,\r\n      leetcode,\r\n      codeforces,\r\n      hackerrank,\r\n      codechef,\r\n    } = body\r\n\r\n    // Validate required fields\r\n    if (!fullName || !rollNumber || !email) {\r\n      return NextResponse.json(\r\n        { error: \"Missing required fields: fullName, rollNumber, email\" },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const db = await getDb()\r\n\r\n    // Check if student already exists\r\n    const existingStudent = await db.collection(\"sProfile\").findOne({ \"Roll no\": rollNumber })\r\n    if (existingStudent) {\r\n      return NextResponse.json({ error: \"Student with this roll number already exists\" }, { status: 400 })\r\n    }\r\n\r\n    // Create profile entry\r\n    const profileData = {\r\n      \"Full name\": fullName,\r\n      \"Roll no\": rollNumber,\r\n      Email: email,\r\n      Phone: phone || \"\",\r\n      \"Date of Birth\": dob || \"\",\r\n      Address: address || \"\",\r\n      Year: year || \"\",\r\n      Branch: branch || \"\",\r\n      Section: section || \"\",\r\n      \"Parent Name\": parentName || \"\",\r\n      \"Parent Phone\": parentPhone || \"\",\r\n      LeetCode: leetcode || \"username_here\",\r\n      CodeForces: codeforces || \"username_here\",\r\n      HackerRank: hackerrank || \"username_here\",\r\n      CodeChef: codechef || \"username_here\",\r\n    }\r\n\r\n    // Create empty academic entry\r\n    const academicData = {\r\n      \"Full name\": fullName,\r\n      \"Roll no\": rollNumber,\r\n      // Placeholder subjects - staff can edit these later\r\n      \"Mathematics\": 0,\r\n      \"Physics\": 0,\r\n      \"Chemistry\": 0,\r\n    }\r\n\r\n    // Create empty co-curricular entry\r\n    const cocircularData = {\r\n      \"Full name\": fullName,\r\n      \"Roll no\": rollNumber,\r\n      \"Sports\": \"none\",\r\n      \"Cultural\": \"none\",\r\n      \"Technical\": \"none\",\r\n    }\r\n\r\n    // Create empty extra-curricular entry\r\n    const extracircularData = {\r\n      \"Full name\": fullName,\r\n      \"Roll no\": rollNumber,\r\n      \"Clubs\": \"none\",\r\n      \"Competitions\": \"none\",\r\n      \"Events\": \"none\",\r\n    }\r\n\r\n    // Insert into all collections\r\n    const profileCollection = db.collection(\"sProfile\")\r\n    const academicCollection = db.collection(\"sAcademics\")\r\n    const cocircularCollection = db.collection(\"sCociruculars\")\r\n    const extracircularCollection = db.collection(\"sEcirculars\")\r\n    const usersCollection = db.collection(\"users\")\r\n\r\n    // Hash password with bcrypt (basic password: student email)\r\n    const hashedPassword = await bcrypt.hash(email, 10)\r\n\r\n    // Create user entry for login\r\n    const userData = {\r\n      email,\r\n      password: hashedPassword,\r\n      role: \"student\",\r\n      rollNumber,\r\n      fullName,\r\n      createdAt: new Date(),\r\n    }\r\n\r\n    await Promise.all([\r\n      profileCollection.insertOne(profileData),\r\n      academicCollection.insertOne(academicData),\r\n      cocircularCollection.insertOne(cocircularData),\r\n      extracircularCollection.insertOne(extracircularData),\r\n      usersCollection.insertOne(userData),\r\n    ])\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Student added successfully\",\r\n      student: {\r\n        rollNumber,\r\n        fullName,\r\n        email,\r\n        year: year || \"N/A\",\r\n        branch: branch || \"N/A\",\r\n        section: section || \"N/A\",\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Error adding student:\", error)\r\n    return NextResponse.json(\r\n      { error: error instanceof Error ? error.message : \"Internal server error\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}